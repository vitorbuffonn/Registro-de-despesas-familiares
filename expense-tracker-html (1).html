<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Despesas Familiares</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .hidden {
            display: none !important;
        }

        .expense-item {
            cursor: pointer;
            transition: all 0.2s;
        }

        .expense-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .expense-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .expense-details.expanded {
            max-height: 500px;
            transition: max-height 0.4s ease-in;
        }

        @media print {
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50">
    <div class="p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                    <h1 class="text-3xl font-bold text-gray-800">Controle de Despesas</h1>
                </div>
                
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-emerald-100 text-sm">Total Gasto</p>
                                <p class="text-2xl font-bold mt-1" id="totalAmount">R$ 0,00</p>
                            </div>
                            <svg class="w-10 h-10 text-emerald-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-teal-100 text-sm">Total de Despesas</p>
                                <p class="text-2xl font-bold mt-1" id="totalCount">0</p>
                            </div>
                            <svg class="w-10 h-10 text-teal-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm">Pessoas Cadastradas</p>
                                <p class="text-2xl font-bold mt-1" id="totalPeople">0</p>
                            </div>
                            <svg class="w-10 h-10 text-green-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left Column -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Manage People -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            Pessoas
                        </h2>
                        
                        <div id="peopleList" class="space-y-2 mb-4"></div>

                        <div id="addPersonForm" class="hidden space-y-2">
                            <input
                                type="text"
                                id="newPersonName"
                                placeholder="Nome da pessoa"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none"
                            />
                            <div class="flex gap-2">
                                <button onclick="addPerson()" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 rounded-lg transition-colors">
                                    Adicionar
                                </button>
                                <button onclick="cancelAddPerson()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 rounded-lg transition-colors">
                                    Cancelar
                                </button>
                            </div>
                        </div>

                        <button onclick="showAddPersonForm()" id="showAddPersonBtn" class="w-full bg-emerald-100 hover:bg-emerald-200 text-emerald-700 font-semibold py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Nova Pessoa
                        </button>
                    </div>

                    <!-- Add Expense Form -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Nova Despesa
                        </h2>
                        
                        <form onsubmit="addExpense(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Pessoa</label>
                                <select id="personSelect" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none">
                                    <option value="">Selecione uma pessoa</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Descrição</label>
                                <input type="text" id="description" required placeholder="Ex: Almoço no restaurante" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none" />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
                                <input type="number" id="amount" required step="0.01" min="0.01" placeholder="0.00" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none" />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                                <select id="category" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none">
                                    <option value="alimentacao">Alimentação</option>
                                    <option value="transporte">Transporte</option>
                                    <option value="moradia">Moradia</option>
                                    <option value="saude">Saúde</option>
                                    <option value="lazer">Lazer</option>
                                    <option value="educacao">Educação</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                                <input type="date" id="date" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none" />
                            </div>

                            <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                Adicionar Despesa
                            </button>
                        </form>

                        <!-- Summary by Person -->
                        <div id="summaryByPerson" class="hidden mt-6 pt-6 border-t border-gray-200">
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">Gastos por Pessoa</h3>
                            <div id="personSummary" class="space-y-2"></div>
                        </div>

                        <!-- Summary by Category -->
                        <div id="summaryByCategory" class="hidden mt-4 pt-4 border-t border-gray-200">
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">Gastos por Categoria</h3>
                            <div id="categorySummary" class="space-y-2"></div>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Expenses List -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-4">
                            <h2 class="text-xl font-bold text-gray-800">Histórico de Despesas</h2>
                            <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
                                <select id="filterPerson" onchange="filterExpenses()" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:outline-none">
                                    <option value="todos">Todas as pessoas</option>
                                </select>
                                <select id="filterCategory" onchange="filterExpenses()" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:outline-none">
                                    <option value="todos">Todas as categorias</option>
                                    <option value="alimentacao">Alimentação</option>
                                    <option value="transporte">Transporte</option>
                                    <option value="moradia">Moradia</option>
                                    <option value="saude">Saúde</option>
                                    <option value="lazer">Lazer</option>
                                    <option value="educacao">Educação</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                        </div>

                        <!-- Filtered Total -->
                        <div id="filteredTotal" class="hidden mb-4 p-4 bg-gradient-to-r from-emerald-100 to-green-100 rounded-lg border-2 border-emerald-300">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <svg class="w-5 h-5 text-emerald-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span id="filteredTotalLabel" class="text-sm font-medium text-emerald-900">Total:</span>
                                </div>
                                <span id="filteredTotalAmount" class="text-2xl font-bold text-emerald-700">R$ 0,00</span>
                            </div>
                            <p id="filteredTotalCount" class="text-xs text-emerald-700 mt-1"></p>
                        </div>

                        <div id="expensesList" class="space-y-3 max-h-[700px] overflow-y-auto">
                            <div class="text-center py-12 text-gray-400">
                                <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                </svg>
                                <p class="text-lg">Nenhuma despesa registrada</p>
                                <p class="text-sm mt-2">Adicione sua primeira despesa para começar!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Categories configuration
        const categories = {
            alimentacao: { name: 'Alimentação', color: 'bg-emerald-500' },
            transporte: { name: 'Transporte', color: 'bg-teal-500' },
            moradia: { name: 'Moradia', color: 'bg-green-500' },
            saude: { name: 'Saúde', color: 'bg-lime-500' },
            lazer: { name: 'Lazer', color: 'bg-cyan-500' },
            educacao: { name: 'Educação', color: 'bg-green-600' },
            outros: { name: 'Outros', color: 'bg-slate-500' }
        };

        // Data storage
        let people = [];
        let expenses = [];

        // Load data from localStorage
        function loadData() {
            const savedPeople = localStorage.getItem('people');
            const savedExpenses = localStorage.getItem('expenses');
            
            if (savedPeople) people = JSON.parse(savedPeople);
            if (savedExpenses) expenses = JSON.parse(savedExpenses);
            
            renderPeople();
            renderExpenses();
            updateSummary();
            updateFilters();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('people', JSON.stringify(people));
            localStorage.setItem('expenses', JSON.stringify(expenses));
        }

        // Show add person form
        function showAddPersonForm() {
            document.getElementById('addPersonForm').classList.remove('hidden');
            document.getElementById('showAddPersonBtn').classList.add('hidden');
            document.getElementById('newPersonName').focus();
        }

        // Cancel add person
        function cancelAddPerson() {
            document.getElementById('addPersonForm').classList.add('hidden');
            document.getElementById('showAddPersonBtn').classList.remove('hidden');
            document.getElementById('newPersonName').value = '';
        }

        // Add person
        function addPerson() {
            const name = document.getElementById('newPersonName').value.trim();
            
            if (!name) {
                alert('Digite um nome válido');
                return;
            }

            const newPerson = {
                id: Date.now().toString(),
                name: name
            };

            people.push(newPerson);
            saveData();
            renderPeople();
            updateFilters();
            cancelAddPerson();
        }

        // Delete person
        function deletePerson(id) {
            const hasExpenses = expenses.some(e => e.person === id);
            
            if (hasExpenses) {
                alert('Não é possível deletar pessoa com despesas registradas');
                return;
            }

            if (confirm('Tem certeza que deseja deletar esta pessoa?')) {
                people = people.filter(p => p.id !== id);
                saveData();
                renderPeople();
                updateFilters();
            }
        }

        // Render people list
        function renderPeople() {
            const list = document.getElementById('peopleList');
            
            if (people.length === 0) {
                list.innerHTML = '<p class="text-sm text-gray-500 mb-4">Adicione pessoas para começar</p>';
            } else {
                list.innerHTML = people.map(p => `
                    <div class="flex items-center justify-between p-3 bg-emerald-50 rounded-lg">
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span class="font-medium text-gray-800">${p.name}</span>
                        </div>
                        <button onclick="deletePerson('${p.id}')" class="p-1 text-red-500 hover:bg-red-50 rounded transition-colors" title="Deletar pessoa">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                `).join('');
            }

            document.getElementById('totalPeople').textContent = people.length;
        }

        // Update filters
        function updateFilters() {
            const personSelect = document.getElementById('personSelect');
            const filterPerson = document.getElementById('filterPerson');
            
            const personOptions = people.map(p => 
                `<option value="${p.id}">${p.name}</option>`
            ).join('');
            
            personSelect.innerHTML = '<option value="">Selecione uma pessoa</option>' + personOptions;
            filterPerson.innerHTML = '<option value="todos">Todas as pessoas</option>' + personOptions;
        }

        // Add expense
        function addExpense(event) {
            event.preventDefault();
            
            const person = document.getElementById('personSelect').value;
            const description = document.getElementById('description').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;

            if (!person || !description || !amount || amount <= 0) {
                alert('Preencha todos os campos corretamente');
                return;
            }

            const newExpense = {
                id: Date.now().toString(),
                person,
                description,
                amount,
                category,
                date,
                timestamp: Date.now()
            };

            expenses.unshift(newExpense);
            saveData();
            renderExpenses();
            updateSummary();

            // Reset form
            document.getElementById('description').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('category').value = 'alimentacao';
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        // Delete expense
        function deleteExpense(id) {
            if (confirm('Tem certeza que deseja deletar esta despesa?')) {
                expenses = expenses.filter(e => e.id !== id);
                saveData();
                renderExpenses();
                updateSummary();
            }
        }

        // Toggle expense details
        function toggleDetails(id) {
            const details = document.getElementById('details-' + id);
            details.classList.toggle('expanded');
        }

        // Get person name
        function getPersonName(id) {
            const person = people.find(p => p.id === id);
            return person ? person.name : 'Desconhecido';
        }

        // Filter expenses
        function filterExpenses() {
            renderExpenses();
            updateSummary();
        }

        // Get filtered expenses
        function getFilteredExpenses() {
            const filterPerson = document.getElementById('filterPerson').value;
            const filterCategory = document.getElementById('filterCategory').value;

            return expenses.filter(e => {
                const matchPerson = filterPerson === 'todos' || e.person === filterPerson;
                const matchCategory = filterCategory === 'todos' || e.category === filterCategory;
                return matchPerson && matchCategory;
            });
        }

        // Render expenses
        function renderExpenses() {
            const list = document.getElementById('expensesList');
            const filtered = getFilteredExpenses();
            
            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-12 text-gray-400">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                        <p class="text-lg">Nenhuma despesa registrada</p>
                        <p class="text-sm mt-2">Adicione sua primeira despesa para começar!</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = filtered.map(expense => `
                <div class="expense-item p-4 bg-gradient-to-r from-emerald-50 to-green-50 rounded-lg" onclick="toggleDetails('${expense.id}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4 flex-1">
                            <div class="${categories[expense.category].color} w-12 h-12 rounded-lg flex items-center justify-center shadow-sm flex-shrink-0">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="font-semibold text-gray-800 truncate">${expense.description}</h3>
                                <div class="flex flex-wrap items-center gap-2 mt-1">
                                    <span class="px-2 py-1 rounded text-xs ${categories[expense.category].color} text-white">
                                        ${categories[expense.category].name}
                                    </span>
                                    <span class="flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs font-medium">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        ${getPersonName(expense.person)}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 flex-shrink-0">
                